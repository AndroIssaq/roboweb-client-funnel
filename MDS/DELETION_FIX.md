# โ ุฅุตูุงุญ ุชุฃููุฏ ุญุฐู ุงูุนููุฏ

## ุงููุดููุฉ:
ุนูุฏ ุงูุถุบุท ุนูู "ุชุฃููุฏ ุงูุญุฐู" ูู ููุญุฉ ุชุญูู ุงูุฃุฏููุ ุงูุนูุฏ ูุง ููุญุฐู.

**ุงูุณุจุจ**: ุงุณุชุฎุฏุงู foreign key joins ูู `reviewDeletionRequest()`

---

## ุงูุญู:

### **ุชู ุชุนุฏูู `lib/actions/contract-deletion.ts`**:

```typescript
// ูุจู:
const { data: request } = await supabase
  .from("contract_deletion_requests")
  .select(`
    *,
    contract:contracts(...),
    requester:users!(...)
  `)
  .single()

// ุจุนุฏ:
const { data: request } = await supabase
  .from("contract_deletion_requests")
  .select("*")
  .maybeSingle()

// ุซู ุฌูุจ ุงูุจูุงูุงุช ุจุดูู ูููุตู
const { data: contractData } = await supabase
  .from("contracts")
  .select("contract_number, client_id")
  .eq("id", request.contract_id)
  .maybeSingle()

const { data: requesterData } = await supabase
  .from("users")
  .select("full_name, email")
  .eq("id", request.requested_by)
  .maybeSingle()
```

---

## ๐ฏ Workflow ุญุฐู ุงูุนูุฏ:

### **1. ุงูุดุฑูู ูุทูุจ ุญุฐู ุนูุฏ**:
```
1. ููุชุญ /affiliate/contracts/[id]
2. ูุถุบุท "ุทูุจ ุญุฐู ุงูุนูุฏ"
3. ููุชุจ ุงูุณุจุจ
4. ูุฑุณู ุงูุทูุจ โ
   โ
5. ุฅุดุนุงุฑ ููุฃุฏูู: "ุทูุจ ุญุฐู ุนูุฏ ุฌุฏูุฏ"
```

### **2. ุงูุฃุฏูู ูุฑุงุฌุน ุงูุทูุจ**:
```
1. ููุชุญ /admin/deletion-requests
2. ูุฑู ูุงุฆูุฉ ุงูุทูุจุงุช ุงููุนููุฉ
3. ูุถุบุท "ุนุฑุถ ุงูุชูุงุตูู"
4. ููุฑุฃ ุงูุณุจุจ โ
   โ
5. ูุฎุชุงุฑ: ููุงููุฉ ุฃู ุฑูุถ
```

### **3. ุงูุฃุฏูู ููุงูู ุนูู ุงูุญุฐู**:
```
1. ูุถุบุท "ููุงููุฉ"
2. ููุชุจ ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
3. ูุคูุฏ โ
   โ
4. ุงูุนูุฏ ููุญุฐู ูู DB โ
5. ุฅุดุนุงุฑ ููุดุฑูู: "ุชูุช ุงูููุงููุฉ ุนูู ุญุฐู ุงูุนูุฏ"
6. Email ููุดุฑูู โ
```

### **4. ุงูุฃุฏูู ูุฑูุถ ุงูุทูุจ**:
```
1. ูุถุบุท "ุฑูุถ"
2. ููุชุจ ุงูุณุจุจ
3. ูุคูุฏ โ
   โ
4. ุงูุทูุจ ููุญุฏุซ ูู "ูุฑููุถ"
5. ุงูุนูุฏ ูุจูู ููุฌูุฏ โ
6. ุฅุดุนุงุฑ ููุดุฑูู: "ุชู ุฑูุถ ุทูุจ ุญุฐู ุงูุนูุฏ"
7. Email ููุดุฑูู ูุน ุงูุณุจุจ โ
```

---

## ๐ ุงููููุงุช ุงูููุตูุญุฉ:

### **lib/actions/contract-deletion.ts**:
```typescript
โ requestContractDeletion() - separate queries
โ reviewDeletionRequest() - separate queries โ ุฌุฏูุฏ!
โ getDeletionRequests() - separate queries
โ getContractDeletionStatus() - .maybeSingle()
```

---

## โ ุงูุงุฎุชุจุงุฑ:

### **1. ุงุฎุชุจุฑ ุทูุจ ุงูุญุฐู**:
```
1. ุณุฌู ุฏุฎูู ูุดุฑูู
2. ุงูุชุญ ุนูุฏ
3. ุงุถุบุท "ุทูุจ ุญุฐู ุงูุนูุฏ"
4. ุงูุชุจ ุงูุณุจุจ
5. ุฃุฑุณู โ
6. ูุฌุจ ุฃู ูุธูุฑ "ุชู ุฅุฑุณุงู ุงูุทูุจ" โ
```

### **2. ุงุฎุชุจุฑ ุงูููุงููุฉ ุนูู ุงูุญุฐู**:
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุงูุชุญ /admin/deletion-requests
3. ูุฌุจ ุฃู ุชุฑู ุงูุทูุจ โ
4. ุงุถุบุท "ุนุฑุถ ุงูุชูุงุตูู"
5. ุงุถุบุท "ููุงููุฉ"
6. ุฃูุฏ โ
7. ูุฌุจ ุฃู ููุญุฐู ุงูุนูุฏ โ
8. ูุฌุจ ุฃู ูุตู ุฅุดุนุงุฑ ููุดุฑูู โ
```

### **3. ุงุฎุชุจุฑ ุงูุฑูุถ**:
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุงูุชุญ ุทูุจ ุญุฐู
3. ุงุถุบุท "ุฑูุถ"
4. ุงูุชุจ ุงูุณุจุจ
5. ุฃูุฏ โ
6. ุงูุนูุฏ ูุจูู ููุฌูุฏ โ
7. ูุฌุจ ุฃู ูุตู ุฅุดุนุงุฑ ููุดุฑูู โ
```

---

## ๐จ ูุงุฌูุฉ ุทูุจุงุช ุงูุญุฐู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุทูุจุงุช ุญุฐู ุงูุนููุฏ                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ ุนูุฏ RW-2024-001                  โ โ
โ โ ุทูุจ ูู: ุฃุญูุฏ ูุญูุฏ                   โ โ
โ โ ุงูุณุจุจ: ุงูุนููู ุฃูุบู ุงูุทูุจ            โ โ
โ โ                                     โ โ
โ โ [ุนุฑุถ ุงูุชูุงุตูู] [ููุงููุฉ] [ุฑูุถ]      โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุญุงูุงุช ุงูุทูุจ:

### **pending** (ูุนูู):
```
- ุงูุทูุจ ุฌุฏูุฏ
- ูู ุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ุงูุฃุฏูู
- ูุธูุฑ ูู ูุงุฆูุฉ ุงูุทูุจุงุช
```

### **approved** (ููุงูู ุนููู):
```
- ุชูุช ุงูููุงููุฉ
- ุงูุนูุฏ ุชู ุญุฐูู
- ุฅุดุนุงุฑ ููุดุฑูู
```

### **rejected** (ูุฑููุถ):
```
- ุชู ุงูุฑูุถ
- ุงูุนูุฏ ูุง ูุฒุงู ููุฌูุฏ
- ุฅุดุนุงุฑ ููุดุฑูู ูุน ุงูุณุจุจ
```

---

## ๐ ุงูุฃูุงู:

### **ุงูุดุฑูู**:
```
โ ููุฏุฑ ูุทูุจ ุญุฐู ุนููุฏู ููุท
โ ูุง ููุฏุฑ ูุญุฐู ูุจุงุดุฑุฉ
โ ูุง ููุฏุฑ ูุฑุงุฌุน ุทูุจุงุช ุงูุขุฎุฑูู
```

### **ุงูุฃุฏูู**:
```
โ ูุดูู ุฌููุน ุทูุจุงุช ุงูุญุฐู
โ ููุงูู ุฃู ูุฑูุถ
โ ูุญุฐู ุงูุนูุฏ ุนูุฏ ุงูููุงููุฉ
โ ูุฑุณู ุฅุดุนุงุฑุงุช
```

---

## ๐ ุงููุชูุฌุฉ:

**ุงูุขู ูุนูู ุจุดูู ุตุญูุญ**:
- โ ุงูุดุฑูู ููุฏุฑ ูุทูุจ ุญุฐู
- โ ุงูุฃุฏูู ูุดูู ุงูุทูุจุงุช
- โ ุงูููุงููุฉ ุชุญุฐู ุงูุนูุฏ
- โ ุงูุฑูุถ ูุญูุธ ุงูุนูุฏ
- โ ุงูุฅุดุนุงุฑุงุช ุชุตู
- โ Emails ุชูุฑุณู

**ุฌุฑุจ ุงูุขู! ๐**
