# ๐ Notification Badge Feature - Realtime

## ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:

### **Badge ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ**:
```
โ ูุธูุฑ badge ุฃุญูุฑ ุจุฌุงูุจ "ุงูุฅุดุนุงุฑุงุช"
โ ูุนุฑุถ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
โ ูุชุญุฏุซ ูู ุงูููุช ุงููุนูู (Realtime)
โ ูุธูุฑ "99+" ุฅุฐุง ูุงู ุงูุนุฏุฏ ุฃูุซุฑ ูู 99
```

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ:

### **1. hooks/use-unread-notifications.ts**:
```typescript
// Hook ูุฎุตุต ูุฌูุจ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
// ูุน Realtime updates

export function useUnreadNotifications(userId: string | undefined) {
  const [unreadCount, setUnreadCount] = useState(0)
  
  useEffect(() => {
    // Fetch initial count
    fetchUnreadCount()
    
    // Subscribe to realtime changes
    const channel = supabase
      .channel("notifications-changes")
      .on("postgres_changes", {
        event: "*",
        table: "notifications",
        filter: `user_id=eq.${userId}`,
      }, () => {
        fetchUnreadCount()
      })
      .subscribe()
    
    return () => {
      supabase.removeChannel(channel)
    }
  }, [userId])
  
  return unreadCount
}
```

---

## ๐จ ุงููููุงุช ุงูููุญุฏุซุฉ:

### **1. components/admin/admin-nav.tsx**:
```typescript
โ ุงุณุชุฎุฏุงู useUnreadNotifications hook
โ ุนุฑุถ Badge ุจุฌุงูุจ "ุงูุฅุดุนุงุฑุงุช"
โ Realtime updates
```

### **2. components/affiliate/affiliate-nav.tsx**:
```typescript
โ ุงุณุชุฎุฏุงู useUnreadNotifications hook
โ ุนุฑุถ Badge ุจุฌุงูุจ "ุงูุฅุดุนุงุฑุงุช"
โ Realtime updates
```

### **3. components/client/client-nav.tsx**:
```typescript
โ ุงุณุชุฎุฏุงู useUnreadNotifications hook
โ ุนุฑุถ Badge ุจุฌุงูุจ "ุงูุฅุดุนุงุฑุงุช"
โ Realtime updates
```

---

## ๐ฏ ููู ูุนูู:

### **1. ุนูุฏ ุชุญููู ุงูุตูุญุฉ**:
```
1. ูุฌูุจ user_id ุงูุญุงูู
2. ูุฌูุจ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
3. ูุนุฑุถ Badge ุฅุฐุง ูุงู ุงูุนุฏุฏ > 0
```

### **2. ุนูุฏ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ**:
```
1. Supabase Realtime ููุชุดู ุงูุชุบููุฑ
2. Hook ูุนูุฏ ุฌูุจ ุงูุนุฏุฏ
3. Badge ูุชุญุฏุซ ุชููุงุฆูุงู โก
4. ูุง ุญุงุฌุฉ ูู refresh ุงูุตูุญุฉ
```

### **3. ุนูุฏ ูุฑุงุกุฉ ุฅุดุนุงุฑ**:
```
1. ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุฅุดุนุงุฑ
2. ูุชู ุชุญุฏูุซ read = true
3. Realtime ููุชุดู ุงูุชุบููุฑ
4. Badge ูุชุญุฏุซ (ูููุต ุงูุนุฏุฏ) โก
```

---

## ๐จ ุดูู Badge:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sidebar                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ ููุญุฉ ุงูุชุญูู                  โ
โ ๐ ุงูุฅุดุนุงุฑุงุช          [3] โ    โ
โ ๐ ุงูุนููุฏ                       โ
โ ๐ฅ ุงูุนููุงุก                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### **ุงูุฃููุงู**:
```
- Badge: ุฃุญูุฑ (destructive)
- ุงููุต: ุฃุจูุถ
- ุงูุดูู: ุฏุงุฆุฑู
- ุงูุญุฌู: ุตุบูุฑ (h-5)
```

---

## โก Realtime Events:

### **ุงูุฃุญุฏุงุซ ุงูููุฑุงูุจุฉ**:
```typescript
event: "*"  // ุฌููุน ุงูุฃุญุฏุงุซ:
  - INSERT  // ุฅุดุนุงุฑ ุฌุฏูุฏ
  - UPDATE  // ุชุญุฏูุซ ุฅุดุนุงุฑ (ูุซู read = true)
  - DELETE  // ุญุฐู ุฅุดุนุงุฑ
```

### **Filter**:
```typescript
filter: `user_id=eq.${userId}`
// ููุท ุงูุฅุดุนุงุฑุงุช ุงูุฎุงุตุฉ ุจุงููุณุชุฎุฏู ุงูุญุงูู
```

---

## ๐ ุงูุฃุฏุงุก:

### **Optimization**:
```typescript
โ ุงุณุชุฎุฏุงู count ุจุฏูุงู ูู select *
โ head: true (ูุง ูุฌูุจ ุงูุจูุงูุงุช)
โ filter ุนูู user_id
โ cleanup ุนูุฏ unmount
```

### **Query**:
```typescript
const { count } = await supabase
  .from("notifications")
  .select("*", { count: "exact", head: true })
  .eq("user_id", userId)
  .eq("read", false)
```

---

## ๐ฏ ุงูุณููุงุฑูููุงุช:

### **ุณููุงุฑูู 1: ุฅุดุนุงุฑ ุฌุฏูุฏ**:
```
1. ุดุฑูู ููุดุฆ ุนูุฏ
   โ
2. ุฅุดุนุงุฑ ููุฑุณู ููุฃุฏูู
   โ
3. Realtime ููุชุดู INSERT
   โ
4. Badge ูุธูุฑ [1] โก
   โ
5. ูุง ุญุงุฌุฉ ูู refresh
```

### **ุณููุงุฑูู 2: ูุฑุงุกุฉ ุฅุดุนุงุฑ**:
```
1. ุฃุฏูู ููุชุญ ุงูุฅุดุนุงุฑุงุช
   โ
2. ูุถุบุท ุนูู ุฅุดุนุงุฑ
   โ
3. read = true
   โ
4. Realtime ููุชุดู UPDATE
   โ
5. Badge ูููุต [0] โก
   โ
6. Badge ูุฎุชูู
```

### **ุณููุงุฑูู 3: ุนุฏุฉ ุฅุดุนุงุฑุงุช**:
```
1. 5 ุฅุดุนุงุฑุงุช ุบูุฑ ููุฑูุกุฉ
   โ
2. Badge ูุนุฑุถ [5]
   โ
3. ููุฑุฃ 2 ูููุง
   โ
4. Badge ูุชุญุฏุซ [3] โก
```

### **ุณููุงุฑูู 4: ุฃูุซุฑ ูู 99**:
```
1. 150 ุฅุดุนุงุฑ ุบูุฑ ููุฑูุก
   โ
2. Badge ูุนุฑุถ [99+]
   โ
3. ููุฑุฃ 60 ูููุง
   โ
4. Badge ูุชุญุฏุซ [90] โก
```

---

## โ ุงูุงุฎุชุจุงุฑ:

### **1. ุงุฎุชุจุฑ Badge**:
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุงูุชุญ sidebar
3. ูุฌุจ ุฃู ุชุฑู Badge ุฅุฐุง ูุงู ููุงู ุฅุดุนุงุฑุงุช โ
```

### **2. ุงุฎุชุจุฑ Realtime**:
```
1. ุงูุชุญ ุชุงุจ 1: ุฃุฏูู
2. ุงูุชุญ ุชุงุจ 2: ุดุฑูู
3. ูู ุชุงุจ 2: ุฃูุดุฆ ุนูุฏ
4. ูู ุชุงุจ 1: Badge ูุธูุฑ ุชููุงุฆูุงู โกโ
5. ูุง ุญุงุฌุฉ ูู refresh
```

### **3. ุงุฎุชุจุฑ ุงููุฑุงุกุฉ**:
```
1. ุงูุชุญ /admin/notifications
2. ุงุถุบุท ุนูู ุฅุดุนุงุฑ
3. Badge ูููุต ุชููุงุฆูุงู โกโ
```

### **4. ุงุฎุชุจุฑ ุฌููุน ุงูุฃุฏูุงุฑ**:
```
โ Admin - ูุฑู badge
โ Affiliate - ูุฑู badge
โ Client - ูุฑู badge
```

---

## ๐ ุงููุชูุฌุฉ:

**ุงูุขู ูุนูู ุจุดูู ุงุญุชุฑุงูู**:
- โ Badge ูุธูุฑ ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ Realtime updates ุจุฏูู refresh
- โ ูุนูู ูุฌููุน ุงูุฃุฏูุงุฑ
- โ ุฃุฏุงุก ูุญุณู
- โ UX ููุชุงุฒ

**ุฌุฑุจ ุงูุขู! ๐**
